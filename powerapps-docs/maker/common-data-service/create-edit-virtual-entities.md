---
title: アプリ用 Common Data Service を使用した仮想エンティティの作成および編集 | MicrosoftDocs
description: 仮想エンティティの作成方法の説明
ms.custom: ''
ms.date: 06/27/2018
ms.reviewer: ''
ms.service: crm-online
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
applies_to:
  - Dynamics 365 (online)
  - Dynamics 365 Version 9.x
  - powerapps
ms.assetid: 44834893-0bf6-4a64-8f06-7583fe08330d
caps.latest.revision: 11
author: Mattp123
ms.author: matp
manager: kvivek
search.audienceType:
  - maker
search.app:
  - PowerApps
  - D365CE
---
# <a name="create-and-edit-virtual-entities-that-contain-data-from-an-external-data-source"></a>外部データ ソースからのデータを格納する仮想エンティティの作成および編集

仮想エンティティはアプリ用 Common Data Service のユーザー定義エンティティであり、外部データ ソースからのデータが含まれるフィールドがあります。 仮想エンティティは通常のエンティティ レコードと同じようにお使いのアプリでユーザーに表示されますが、Azure SQL Database などの外部データベースからのデータを含みます。 仮想エンティティに基づくレコードは、アプリ Web サービス用 CDS を使って開発されたユーザー定義のクライアントを含む、すべてのクライアントで利用できます。  
  
以前は、異種のデータ ソースを統合するには、データの移行またはユーザー定義のプラグインの開発のために、サーバー側またはクライアント側のいずれかに、コネクタを作成する必要がありました。 ただし、仮想エンティティを使用して、実行時に外部データ ソースに直接接続できるので、データ レプリケーションをする必要なく、外部データ ソースから特定のデータを環境で利用することができます。  

仮想エンティティは、*データ プロバイダー*、*データ ソース* レコード、および *仮想エンティティ* の 3 つのメイン コンポーネントで構成されます。 データ プロバイダーは、プラグインとデータ ソース エンティティで構成されます。 データ ソースは、接続パラメーターのスキーマを表すメタデータを含む、アプリ用 CDS のエンティティ レコードです。 各仮想エンティティは、エンティティ定義内のデータ ソースを参照します。  
  
アプリ用 CDS には、外部データにアクセスする OData v4 Web サービスへの接続に使用する、OData データ プロバイダーが含まれています。 
  
また、開発者は、独自のデータ プロバイダーを作成できます。 データ プロバイダーは、環境にソリューションとしてインストールされます。 詳細: [開発者ドキュメント: 仮想エンティティに関する入門情報](../../developer/common-data-service/virtual-entities/get-started-ve.md)
  
 ![仮想エンティティ ダイアグラム](media/virtual-entity-diagram.png "仮想エンティティ ダイアグラム")  
  
<a name="benefits"></a> 
  
## <a name="virtual-entity-benefits"></a>仮想エンティティの機能  
  
- 開発者は、プラグインを実装し、アプリ Web サービス用 CDS およびプラグイン登録ツールを使って外部データを読み取ることができます。  
- システム カスタマイザーは、PowerApps ソリューション エクスプローラーを使用してデータ ソース レコードを構成し、コードをまったく記述せずに、外部データへのアクセスに使用される仮想エンティティを作成します。  
- エンド ユーザーは、仮想エンティティによって作成されたレコードを使って、フィールド、グリッド、検索結果、Fetch XML ベースのレポートやダッシュボードのデータを表示できます。  
  
<a name="AddDataSource"></a> 
  
## <a name="add-a-data-source-to-use-for-virtual-entities"></a>仮想エンティティに使用するデータ ソースの追加 
 
 開発者は、仮想エンティティのデータ プロバイダーとして使用するユーザー定義のプラグインを作成できます。 あるいは、提供されている OData v4 データ プロバイダーを使用することもできます。 詳細: [OData v4 データ プロバイダーの構成、要件、ベスト プラクティス](virtual-entity-odata-provider-requirements.md)  
  
1. **[設定](../model-driven-apps/advanced-navigation.md#settings)** > **管理** > **仮想エンティティ データ ソース**の順に移動します。  
1. [操作] ツール バーで、**新規**を選択します。  
1. **データ プロバイダーの選択**ダイアログ ボックスで、次のデータ ソースから選択してから、**OK** を選択します。
 
    |データ プロバイダー|説明|
    |--|--|
    |*カスタム データ プロバイダー*|データ プロバイダー プラグインをインポートした場合は、データ プロバイダーはここに表示されます。 詳細 [開発者ドキュメント: 仮想エンティティに関する入門情報](/dynamics365/customer-engagement/developer/virtual-entities/get-started-ve)|
    |**OData v4 データ プロバイダー**|アプリ用 CDS には、OData v4 Web サービスで使用できる OData データ プロバイダーが含まれています。 詳細 [OData v4 データ プロバイダーの構成、要件、ベスト プラクティス](virtual-entity-odata-provider-requirements.md)|

  
### <a name="add-a-secured-field-to-a-data-source"></a>データ ソースにセキュリティで保護されたフィールドを追加する

データ ソースでは、他のエンティティと同じようにフィールドを作成します。 暗号化されたデータまたは機密データの場合、データ ソースのカスタム フィールドでデータ ソース シークレット属性を有効にします。 たとえば、データベース接続文字列を含むフィールドのセキュリティを保護する場合です。 

> [!NOTE]
> データ ソース シークレットの属性は、データ ソース フォームに追加されたフィールドでのみ使用できます。

> [!div class="mx-imgBorder"] 
> ![データ ソース シークレットの属性](media/datasourcesecret.png)
  
<a name="createVirtualEntity"></a> 
  
## <a name="create-a-virtual-entity"></a>仮想エンティティを作成する
  
仮想エンティティは、ここで説明したいくつかの追加の属性はありますが、アプリ用 CDS の他のエンティティと同様に作成できます。 ソリューション エクスプローラーを使用して仮想エンティティが作成されます。

> [!NOTE]
>  仮想エンティティは、データ ソースとして**なし**を選択して作成することもできますが、データを取得するには仮想エンティティにデータ ソースが必要です。 詳細 [仮想エンティティに使用するデータ ソースの追加](#AddDataSource)

### <a name="open-solution-explorer"></a>ソリューション エクスプローラーを開きます

作成する仮想エンティティの名前の一部はカスタマイズの接頭辞です。 これは、作業中のソリューションの発行者に基づいて設定されます。 カスタマイズの接頭辞に注意を払う場合は、カスタマイズの接頭辞がこの仮想エンティティに対して必要な接頭辞であるアンマネージド ソリューションで作業するようにします。 詳細: [ソリューション発行者の接頭辞を変更する](change-solution-publisher-prefix.md) 

[!INCLUDE [cc_navigate-solution-from-powerapps-portal](../../includes/cc_navigate-solution-from-powerapps-portal.md)]

### <a name="create-a-virtual-entity"></a>仮想エンティティを作成する
  
1. ソリューション エクスプローラーで、新しいエンティティを作成します。 これを行うには、左側のナビゲーション ウィンドウで**エンティティ**をクリックしてから、**新規**を選択します。  
2. **エンティティ定義**の**概要**タブで、**仮想エンティティ**を選択してから、**データ ソース**ドロップダウン リストで、必要なデータ ソースを選択します。  

    > [!div class="mx-imgBorder"] 
    > ![エンティティ定義の仮想エンティティ オプション](media/virtual-entity-click-option.png)  
  
1. エンティティ定義で、以下の必須フィールドに入力します。
  
    |フィールド|説明|
    |--|--|
    |**外部名**|このエンティティがマッピングする外部データ ソースの一覧の名前を入力します。|
    |**外部コレクション名**|このエンティティがマッピングする外部データ ソースの一覧の複数名を入力します。|
      
    ドキュメント ファイルにアクセスするために Azure Cosmos DB データ プロバイダーを使用する *Movie* という名前の仮想エンティティの例を以下に示します。  
      
    > [!div class="mx-imgBorder"] 
    > ![Azure Cosmos DB データ プロバイダーを使用した仮想エンティティ定義](media/virtual-entity-definition.PNG)  
      
    > [!IMPORTANT]
    > アクセス チーム、キュー、および簡易作成などの複数のオプションは、仮想エンティティでは使用できません。 詳細 [仮想エンティティを使用する際の考慮事項](#considerations)  
      
    必要に応じて、表示名および複数名など、そのほかの必須およびオプション プロパティを入力します。 これらのプロパティの詳細については、「[エンティティの作成および編集](create-edit-entities.md)」を参照してください。  
  
1. 仮想エンティティに対して 1 つまたは複数のフィールドを作成および追加します。 カスタム フィールドの作成に必要な標準のフィールド プロパティに加えて、これらのオプションのプロパティは、仮想エンティティに対して作成する各カスタム フィールドに使用できます。

    |フィールド|説明|
    |--|--|
    |**外部名**|通常、これは、フィールドに表示するデータを識別するために一意の名前です。|
    |**外部の種類の名前**|作成するフィールドの種類が OptionSet の場合: このプロパティは、オプション セットに対する外部サービスの値セットの外部名にマッピングされます。  通常、これは、文字列値クラスの列挙値または名前です。 完全修飾名が必要なときは、外部型名を使用できます。  たとえば、[*型名*].[*値*] など、クエリのパラメーターが完全修飾名を必要とする OData を含む [*型名*] として。|
    |**外部値**|作成するフィールドの種類が OptionSet の場合: このプロパティは、オプション セット項目に対する外部データ ソースで対応する値にマッピングされます。  入力されたこの値を使用して、アプリに表示するオプション セット項目が決定されます。  |

    必要に応じて、追加プロパティを入力します。 これらのプロパティの詳細については、「[フィールドの作成および編集](create-edit-fields.md)」を参照してください。  
  
1. **フィールド**プロパティ ページで、**保存して閉じる**を選択します。  
1. ソリューション エクスプローラーのツール バーで、**保存**を選択します。  
1. ソリューション エクスプローラーのツール バーで、**公開**を選択します。  
1. ソリューション エクスプローラーを閉じます。  

<a name="considerations"></a>
   
## <a name="considerations-when-you-use-virtual-entities"></a>仮想エンティティを使用する際の考慮事項  

仮想エンティティには次のような制限があります。  
  
- すべての仮想エンティティは読み取り専用です。  
- 既存のエンティティは、仮想エンティティに変換できません。  
- 既定では、仮想エンティティには名前および ID フィールドのみが含まれます。  [状態] または[作成日/修正日] などの、他のシステム管理フィールドはサポートされません。
- 仮想エンティティは、通貨、イメージ、または顧客データ タイプを持つカスタム フィールドはサポートしません。
- 仮想エンティティは監査をサポートしていません。  
- 仮想エンティティ フィールドは、ロールアップまたは計算フィールドでは使用できません。
- 仮想エンティティは、エンティティの活動の種類になることはできません。  
- エンティティ テーブル行に影響する多くの機能が仮想エンティティでは有効にできません。  例には、キュー、ナレッジ マネージメント、SLA、重複データ検出、変更の追跡、Mobile offline 機能、フィールド セキュリティ、関連性検索、Dynamics 365 Web ポータル ソリューションのポータル、仮想エンティティ間の N:N の関連付けが含まれます。  
- 仮想エンティティは組織によって所有され、行レベルのアプリ用 Common Data Service のセキュリティ概念はサポートされません。 外部データ ソースには独自のセキュリティ モデルを実装することをお勧めします。  
- 高度な検索で仮想エンティティを使用するとき、単一のデータ ソースを対象にすることをお勧めします。 たとえば、Common Data Service for Appsのネイティブ データと仮想エンティティ外部データ間に最終的に結合を作成する、高度な検索の作成はサポートされません。  
- 更新で検証されるフィールド メタデータ プロパティは仮想エンティティには適用されません。 たとえば、仮想エンティティ フィールドの整数フィールドには、最小値のゼロに設定できます。 ただし、値は外部データ ソースから取得されるため、仮想エンティティから取得した場合、クエリはゼロ未満の値を返します。  クエリでは最小値のプロパティは示唆されていません。  0を超える値が望ましい場合は、値をそのようにフィルター処理する必要があります。
- 仮想エンティティでは変更の追跡がサポートされておらず、データ エクスポート サービスなどのアプリ用 CDS 機能を使用して同期することができません。
  
### <a name="see-also"></a>関連項目  

[OData v4 データ プロバイダーの要件とベスト プラクティス](virtual-entity-odata-provider-requirements.md)</br> 
[エンティティの作成および編集](create-edit-entities.md)</br>
[フィールドの作成および編集](create-edit-fields.md)
